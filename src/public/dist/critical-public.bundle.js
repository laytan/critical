!function(t){var e={};function i(n){if(e[n])return e[n].exports;var r=e[n]={i:n,l:!1,exports:{}};return t[n].call(r.exports,r,r.exports,i),r.l=!0,r.exports}i.m=t,i.c=e,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)i.d(n,r,function(e){return t[e]}.bind(null,r));return n},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=1)}([,function(t,e,i){const n=i(2);!function(t){"use strict";t(window).load(function(){const e=new n(t);e.getToolbarBtn().on("click",function(t){e.generateCriticalCSS(t)})})}(jQuery)},function(t,e){t.exports=class{constructor(t){this.$=t}getToolbarBtn(){return this.$("#wp-admin-bar-critical-admin-toolbar")}redirect(t){const e=this.getToolbarBtn(),i=this.getHiddenInformation(e),n=this.createForm(i.redirectTo,[{type:"input",name:"critical-css",value:t},{type:"input",name:"critical-post-id",value:i.postID},{type:"input",name:"action",value:"critical-got-css"},{type:"input",name:"_wpnonce",value:i.nonce}]);n.css("display","none").appendTo(this.$("body")).submit(),n.remove()}createForm(t,e,i="POST"){const n=this.$("<form></form>").attr("action",t).attr("method",i),r=e.map(t=>this.$("<"+t.type+"></"+t.type+">").attr("name",t.name).val(t.value));return n.append(r)}getHiddenInformation(t){return{redirectTo:t.find("#critical-admin-toolbar-redirect-to").text(),postID:t.find("#critical-admin-toolbar-post-id").text(),nonce:t.find("#critical-admin-toolbar-nonce").text()}}generateCriticalCSS(t){const e=this.getToolbarBtn();e.find("#critical-admin-toolbar-title").text("").addClass("critical-loader");const i=this.getAllStylesheets().filter(this.isNotAdminStylesheet),n=[];i.forEach(t=>{n.push(this.criticalCSS(t.href))});const r=n.join("\n");this.minify(r,t=>{e.find("#critical-admin-toolbar-title").text("Generate Critical CSS").removeClass("critical-loader"),this.showOptions(t)})}isNotAdminStylesheet(t){return!t.href.includes("admin")}getAllStylesheets(){return this.$('link[rel="stylesheet"]').toArray()}minify(t,e){this.$.ajax("http://localhost/daub/",{method:"POST",data:this.getMinifyData(t),success:function(t){e(t)},error:function(t){console.error(t)}})}getMinifyData(t){return{"critical-input":t,"critical-test":this.$("#critical-is-test").length>0}}criticalCSS(t){console.log("Processing: "+t);var e=document.styleSheets,i=window.innerHeight,n=[];function r(t){if(!t.selectorText)return!1;var e=t.selectorText.split(","),n=[];if(e.length)for(var r in e){var o;try{o=document.querySelector(e[r])}catch(t){}o&&o.offsetTop<=i&&n.push(e[r])}return!!n.length&&n.join(",")+t.cssText.match(/\{.+/)}for(var o in e){var a=e[o],c=a.href,s=a.cssRules;if(t&&c&&c.indexOf(t)>-1)for(var l in s){var d=s[l].media,u=[];if(d){var h=s[l].cssRules;for(var f in h){(p=r(h[f]))&&u.push(p)}if(u.length)try{u.unshift("@media "+d.mediaText+"{"),u.push("}")}catch(t){console.warn(t.message,a)}}else if(!d){var p;(p=r(s[l]))&&u.push(p)}n.push(u.join("\n"))}}return console.log("Critical css:",n.join("\n")),n.join("\n")}showOptions(t){const e=this.$("<div></div>").addClass("critical-modal critical-show-modal").append(this.$("<div></div>").addClass("critical-modal-content").append([this.$("<span></span>").addClass("critical-close-button critical-button critical-top-right").html("&times;"),this.$("<h1></h1>").text("Critical CSS"),this.$("<hr>"),this.$("<details></details>").addClass("critical-css-details").append([this.$("<summary></summary>").text("Toggle CSS"),this.$("<p></p>").text(t)]),this.$("<button></button>").addClass("critical-button critical-primary-button").text("Insert Critical CSS & Defer other CSS").on("click",()=>{this.redirect(t)}),this.$("<button></button>").addClass("critical-button").text("Insert Critical CSS & Do not defer other CSS"),this.$("<button></button>").addClass("critical-close-button critical-button critical-secondary-button").text("Cancel")]));this.$("body").append(e),e.find(".critical-close-button").on("click",t=>{this.$(t.target).parents(".critical-modal").remove()})}}}]);